<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz HTML Extractor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        #printBtn {
            background: #28a745;
        }
        #printBtn:hover {
            background: #218838;
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            break-inside: avoid;
        }
        .selected {
            background-color: #e7f4ff;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .columns-container {
            column-count: 2;
            column-gap: 20px;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #output, #output * {
                visibility: visible;
            }
            #output {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .columns-container {
                column-count: 2;
                column-gap: 20px;
            }
            .question {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <h1>Quiz HTML Extractor</h1>
    <p>Paste your quiz HTML below:</p>
    <textarea id="quizHtmlInput" placeholder="Paste quiz HTML here..."></textarea>
    <div>
        <button onclick="extractQuestions()">Extract Questions</button>
        <button id="printBtn" onclick="window.print()">Print Questions</button>
    </div>
    
    <div id="output"></div>

    <script>
        function extractQuestions() {
            const html = document.getElementById('quizHtmlInput').value;
            if (!html) {
                alert('Please paste some HTML first');
                return;
            }
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Find all question elements
            const questions = doc.querySelectorAll('.que');
            let outputHtml = '';
            
            questions.forEach(question => {
                // Get question number
                const questionNumber = question.querySelector('.qno')?.textContent || 'Unknown';
                
                // Get question text - handle different question types
                let questionText = '';
                
                // For multianswer questions, the structure is different
                if (question.classList.contains('multianswer')) {
                    const formulation = question.querySelector('.formulation.clearfix');
                    if (formulation) {
                        // Clone and remove input elements
                        const clone = formulation.cloneNode(true);
                        clone.querySelectorAll('input, select').forEach(el => el.remove());
                        
                        // Remove the h4 element if present
                        const h4 = clone.querySelector('h4');
                        if (h4) h4.remove();
                        
                        questionText = clone.innerHTML;
                    }
                } else {
                    // Standard handling for other question types
                    const questionTextEl = question.querySelector('.qtext');
                    if (questionTextEl) {
                        const clone = questionTextEl.cloneNode(true);
                        clone.querySelectorAll('input, select').forEach(el => el.remove());
                        questionText = clone.innerHTML;
                    }
                }
                
                // Check question type
                const isMultichoice = question.classList.contains('multichoice');
                const isMultianswer = question.classList.contains('multianswer');
                const isShortanswer = question.classList.contains('shortanswer');
                
                let answersHtml = '';
                
                if (isMultichoice || isMultianswer) {
                    // Handle multiple choice/answer questions
                    const options = question.querySelectorAll('.answer .r0, .answer .r1');
                    
                    if (options.length > 0) {
                        answersHtml = '<ul>';
                        
                        options.forEach(option => {
                            const input = option.querySelector('input[type="radio"], input[type="checkbox"]');
                            const isSelected = input && (input.checked || input.hasAttribute('checked'));
                            
                            const label = option.querySelector('[data-region="answer-label"]');
                            let optionText = label ? label.textContent : option.textContent;
                            
                            answersHtml += `<li${isSelected ? ' class="selected"' : ''}>${optionText}${isSelected ? ' (Selected)' : ''}</li>`;
                        });
                        
                        answersHtml += '</ul>';
                    } else {
                        // Handle dropdown questions
                        const selects = question.querySelectorAll('select');
                        selects.forEach((select, index) => {
                            const selectedOption = select.querySelector('option[selected]');
                            const options = Array.from(select.querySelectorAll('option')).map(opt => opt.textContent);
                            
                            answersHtml += `<p>Dropdown ${index + 1}: ${selectedOption ? `<span class="selected">${selectedOption.textContent} (Selected)</span>` : 'Not answered'}</p>`;
                        });
                    }
                } else if (isShortanswer) {
                    // Handle short answer questions
                    const input = question.querySelector('input[type="text"]');
                    const answer = input ? input.value : 'Not answered';
                    answersHtml = `<p>Answer: <span class="selected">${answer}</span></p>`;
                }
                
                outputHtml += `
                    <div class="question">
                        <h3>Question ${questionNumber}</h3>
                        <div>${questionText}</div>
                        ${answersHtml}
                    </div>
                `;
            });
            
            document.getElementById('output').innerHTML = `
                <div class="columns-container">
                    ${outputHtml || '<p>No questions found.</p>'}
                </div>
            `;
        }
    </script>
</body>
</html>
